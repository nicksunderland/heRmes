<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>HERMES3 PHENOTYPING • heRmes</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="HERMES3 PHENOTYPING">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">heRmes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/hermes_3.html">HERMES 3.0</a></li>
    <li><a class="dropdown-item" href="../articles/hermes_qc_script.html">HERMES QUALITY CONTROL</a></li>
    <li><a class="dropdown-item" href="../articles/hermes3_ukbb_phenotyping.html">HERMES3 PHENOTYPING</a></li>
    <li><a class="dropdown-item" href="../articles/ukbb_phenotyping.html">UKBB phenotyping example</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>HERMES3 PHENOTYPING</h1>
            
      

      <div class="d-none name"><code>hermes3_ukbb_phenotyping.Rmd</code></div>
    </div>

    
    
<p>Packages</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<p>Load the data</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="data-dir">data dir<a class="anchor" aria-label="anchor" href="#data-dir"></a>
</h2>
<p>data_dir &lt;- file.path(Sys.getenv(“DATA_DIR”),
“ukbb_81499_20241114”)</p>
</div>
<div class="section level2">
<h2 id="read-the-data">read the data<a class="anchor" aria-label="anchor" href="#read-the-data"></a>
</h2>
<p>withdraw &lt;- fread(file.path(data_dir,
“withdraw81499_55_20230915.txt”)) demog &lt;- fread(file.path(data_dir,
“data_participant.tsv”)) hesin &lt;- fread(file.path(data_dir,
“data_hesin.tsv”)) diag &lt;- fread(file.path(data_dir,
“data_hesin_diag.tsv”)) oper &lt;- fread(file.path(data_dir,
“data_hesin_oper.tsv”)) self_oper &lt;- fread(file.path(data_dir,
“data_self_reported_procedures.tsv”))</p>
</div>
<div class="section level2">
<h2 id="read-the-codes">read the codes<a class="anchor" aria-label="anchor" href="#read-the-codes"></a>
</h2>
<p>codes &lt;- fread(system.file(“extdata”, “hermes_3_codes”,
“hermes_3_codes.tsv”, package = “heRmes”)) self_reported_codes &lt;-
list( list(name = “Heart Failure”, code = “1076”, code_type =
“ukbb_self_reported_illness”), list(name = “Myocardial infarction”, code
= “1075”, code_type = “ukbb_self_reported_illness”), list(name =
“Hypertrophic cardiomyopathy”, code = “1588”, code_type =
“ukbb_self_reported_illness”), list(name = “Coronary artery bypass
grafting”, code = “1095”, code_type = “ukbb_self_reported_procedure”),
list(name = “Percutaneous coronary intervention”, code = “1070”,
code_type = “ukbb_self_reported_procedure”) ) codes &lt;- rbind(codes,
data.table(Concept = paste0(sapply(self_reported_codes, function(x)
x<span class="math inline">$name), " Self Reported"),
                          Code        = sapply(self_reported_codes,
function(x) x$</span>code), Source = sapply(self_reported_codes,
function(x)
x<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>d</mi><msub><mi>e</mi><mi>t</mi></msub><mi>y</mi><mi>p</mi><mi>e</mi><mo stretchy="false" form="postfix">)</mo><mo>,</mo><mi>D</mi><mi>e</mi><mi>s</mi><mi>c</mi><mi>r</mi><mi>i</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mi>s</mi><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>y</mi><mo stretchy="false" form="prefix">(</mo><mi>s</mi><mi>e</mi><mi>l</mi><msub><mi>f</mi><mi>r</mi></msub><mi>e</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>e</mi><msub><mi>d</mi><mi>c</mi></msub><mi>o</mi><mi>d</mi><mi>e</mi><mi>s</mi><mo>,</mo><mi>f</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">code_type),
                          Description = sapply(self_reported_codes, function(x) x</annotation></semantics></math>name)))
codes[, <code>:=</code>(code = Code, code_type = fcase(Source==“ICD10”,
“icd10”, Source==“ICD9”, “icd9”, Source==“OPCS4”, “opcs4”,
Source==“ukbb_self_reported_illness”, “ukbb_self_reported_illness”,
Source==“ukbb_self_reported_procedure”,
“ukbb_self_reported_procedure”))] codes &lt;-
codes[!is.na(code_type)]</p>
</div>
<div class="section level2">
<h2 id="ethnicity-codes">ethnicity codes<a class="anchor" aria-label="anchor" href="#ethnicity-codes"></a>
</h2>
<p>ethnicity_codes &lt;- list( white = 1, british = 1001,
white_black_caribbean = 2001, indian = 3001, caribbean = 4001, mixed =
2, irish = 1002, white_black_african = 2002, pakistani = 3002, african =
4002, asian_or_asian_british= 3, any_other_white = 1003, white_asian =
2003, bangladeshi = 3003, any_other_black = 4003,
black_or_black_british= 4, any_other_mixed = 2004, any_other_asian =
3004, chinese = 5, other_ethnic_group = 6)</p>
</div>
<div class="section level2">
<h2 id="long-data-of-codes">long data of codes<a class="anchor" aria-label="anchor" href="#long-data-of-codes"></a>
</h2>
<p>cohort &lt;- demog[, list(eid = eid, age =
as.integer(<code>21022-0.0</code>), sex = factor(<code>31-0.0</code>,
levels = 0:1, labels = c(“female”, “male”)), ethnicity =
factor(<code>21000-0.0</code>, levels = unlist(ethnicity_codes), labels
= names(ethnicity_codes)), ethnicity_group =
factor(sub(“([0-9])00[0-9]”, “\1”, <code>21000-0.0</code>), levels =
unlist(ethnicity_codes), labels = names(ethnicity_codes)), genetic_sex =
factor(<code>22001-0.0</code>, levels = 0:1, labels = c(“female”,
“male”)), genetic_ethnicity = factor(<code>22006-0.0</code>, levels = 1,
labels = c(“caucasian”)))] cohort[demog, paste0(“pc”, 1:12) :=
mget(paste0(“i.22009-0.”, 1:12)), on = “eid”]</p>
</div>
<div class="section level2">
<h2 id="check">check<a class="anchor" aria-label="anchor" href="#check"></a>
</h2>
<p>stopifnot(“Failed to parse some date of births” =
all(!is.na(cohort<span class="math inline">$dob)))
stopifnot("some ages / dob indicate cohort age &lt;37, is this right?" =
all(cohort$</span>dob &lt;= as.Date(“1972-01-01”)))</p>
</div>
<div class="section level2">
<h2 id="self-reported-illness-codes">self reported illness codes<a class="anchor" aria-label="anchor" href="#self-reported-illness-codes"></a>
</h2>
<p>self_rep_code_regex &lt;- “20002-[0-9]+\.[0-9]+” self_rep_year_regex
&lt;- “20008-[0-9]+\.[0-9]+” self_rep_code_cols &lt;-
grep(self_rep_code_regex, names(demog), value = TRUE) self_rep_year_cols
&lt;- grep(self_rep_year_regex, names(demog), value = TRUE) demog[,
(self_rep_code_cols) := lapply(.SD, as.character), .SDcols =
self_rep_code_cols] demog[, (self_rep_year_cols) := lapply(.SD,
as.numeric), .SDcols = self_rep_year_cols] self_rep_illness &lt;-
data.table::melt(demog, id.vars = “eid”, measure =
patterns(self_rep_code_regex, self_rep_year_regex), variable.name =
“element”, value.name = c(“code”, “year”), na.rm = TRUE)
self_rep_illness &lt;- self_rep_illness[year != -1 &amp; year != -3] #
unknown / prefer not to answer self_rep_illness[, <code>:=</code>(date =
lubridate::ymd(paste0(as.character(floor(year)), “-01-01”)) +
lubridate::days(as.integer(365.25 * (year - floor(year)))), year = NULL,
element = NULL, code = as.character(code), code_type =
“ukbb_self_reported_illness”)]</p>
</div>
<div class="section level2">
<h2 id="self-reported-procedure-codes">self reported procedure codes<a class="anchor" aria-label="anchor" href="#self-reported-procedure-codes"></a>
</h2>
<p>self_rep_proc_code_regex &lt;- “20004-[0-9]+\.[0-9]+”
self_rep_proc_year_regex &lt;- “20010-[0-9]+\.[0-9]+”
self_rep_proc_code_cols &lt;- grep(self_rep_proc_code_regex,
names(self_oper), value = TRUE) self_rep_proc_year_cols &lt;-
grep(self_rep_proc_year_regex, names(self_oper), value = TRUE)
self_oper[, (self_rep_proc_code_cols) := lapply(.SD, as.character),
.SDcols = self_rep_proc_code_cols] self_oper[, (self_rep_proc_year_cols)
:= lapply(.SD, as.numeric), .SDcols = self_rep_proc_year_cols]
self_rep_oper &lt;- data.table::melt(self_oper, id.vars = “eid”, measure
= patterns(self_rep_proc_code_regex, self_rep_proc_year_regex),
variable.name = “element”, value.name = c(“code”, “year”), na.rm = TRUE)
self_rep_oper &lt;- self_rep_oper[year != -1 &amp; year != -3] # unknown
/ prefer not to answer self_rep_oper[, <code>:=</code>(date =
lubridate::ymd(paste0(as.character(floor(year)), “-01-01”)) +
lubridate::days(as.integer(365.25 * (year - floor(year)))), year = NULL,
element = NULL, code = as.character(code), code_type =
“ukbb_self_reported_procedure”)]</p>
</div>
<div class="section level2">
<h2 id="join-self-reported-diseases-and-procedures">join self reported diseases and procedures<a class="anchor" aria-label="anchor" href="#join-self-reported-diseases-and-procedures"></a>
</h2>
<p>self_rep_illness &lt;- rbind(self_rep_illness, self_rep_oper)</p>
</div>
<div class="section level2">
<h2 id="check-self-report-illness-table">check self report illness table<a class="anchor" aria-label="anchor" href="#check-self-report-illness-table"></a>
</h2>
<p>stopifnot(“unable to parse dates for self-reported illness codes” =
all(!is.na(self_rep_illness<span class="math inline">$date)))
stopifnot("are you sure something happened before 1900?" =
all(self_rep_illness$</span>date &gt; as.Date(“1900-01-01”)))</p>
</div>
<div class="section level2">
<h2 id="get-the-inpatient-diagnosis-codes">get the inpatient diagnosis codes<a class="anchor" aria-label="anchor" href="#get-the-inpatient-diagnosis-codes"></a>
</h2>
<p>hesin[is.na(epistart) | epistart == ““, epistart := admidate]
diag[hesin, date := as.Date(i.epistart), on = c(“eid(participant -
eid)”, “ins_index”)] diag[, eid := <code>eid(participant - eid)</code>]
diag[diag_icd9 == ““, diag_icd9 := NA_character_] diag[diag_icd10 == ““,
diag_icd10 := NA_character_] diag &lt;- data.table::melt(diag, id.vars =
c(“eid”, “date”), measure.vars = c(“diag_icd9”, “diag_icd10”),
variable.name = “code_type”, value.name = “code”, na.rm = TRUE) diag[,
code_type := data.table::fcase(code_type == “diag_icd9”, “icd9”,
code_type == “diag_icd10”, “icd10”)]</p>
</div>
<div class="section level2">
<h2 id="get-the-inpatient-procedure-codes">get the inpatient procedure codes<a class="anchor" aria-label="anchor" href="#get-the-inpatient-procedure-codes"></a>
</h2>
<p>oper[hesin, date := as.Date(i.epistart), on = c(“eid(participant -
eid)”, “ins_index”)] oper[, eid := <code>eid(participant - eid)</code>]
oper[oper3 == ““, oper3 := NA_character_] oper[oper4 == ““, oper4 :=
NA_character_] oper &lt;- data.table::melt(oper, id.vars = c(“eid”,
“date”), measure.vars = c(“oper3”, “oper4”), variable.name =
“code_type”, value.name = “code”, na.rm = TRUE) oper[, code_type :=
data.table::fcase(code_type == “oper3”, “opcs3”, code_type == “oper4”,
“opcs4”)]</p>
</div>
<div class="section level2">
<h2 id="bind-together-the-diagnostic-codes">bind together the diagnostic codes<a class="anchor" aria-label="anchor" href="#bind-together-the-diagnostic-codes"></a>
</h2>
<p>combined &lt;- rbind(self_rep_illness, diag, oper)</p>
</div>
<div class="section level2">
<h2 id="read-in-the-codes-and-annotate">read in the codes and annotate<a class="anchor" aria-label="anchor" href="#read-in-the-codes-and-annotate"></a>
</h2>
<p>combined &lt;- codes[combined, on = c(“code” = “code”, “code_type” =
“code_type”), allow.cartesian = TRUE] combined &lt;-
combined[!is.na(Concept)]</p>
</div>
<div class="section level2">
<h2 id="keep-only-unique-first-occurance-in-any-coding-system">keep only unique, first occurance (in any coding system)<a class="anchor" aria-label="anchor" href="#keep-only-unique-first-occurance-in-any-coding-system"></a>
</h2>
<p>combined &lt;- combined[combined[, .I[which.min(date)], by = c(“eid”,
“Concept”)]$V1]</p>
</div>
<div class="section level2">
<h2 id="add-to-the-cohort">add to the cohort<a class="anchor" aria-label="anchor" href="#add-to-the-cohort"></a>
</h2>
<p>concepts &lt;- unique(codes$Concept) for (g in concepts) {</p>
<p>col_name &lt;- tolower(gsub(” “,”_“, gsub(”[()]“,”“,g)))
cohort[combined[Concept == g], paste0(col_name, c(““,”_first_date”)) :=
list(TRUE, as.Date(i.date)), on = “eid”] cohort[is.na(get(col_name)),
(col_name) := FALSE]</p>
<p>}</p>
</div>
<div class="section level2">
<h2 id="add-the-withdrawal-flags">add the withdrawal flags<a class="anchor" aria-label="anchor" href="#add-the-withdrawal-flags"></a>
</h2>
<p>cohort[withdraw, withdrawal := TRUE, on = c(“eid” = “V1”)]
cohort[is.na(withdrawal), withdrawal := FALSE]</p>
</div>
<div class="section level2">
<h2 id="run-phenotyping">run phenotyping<a class="anchor" aria-label="anchor" href="#run-phenotyping"></a>
</h2>
</div>
<div class="section level2">
<h2 id="any-ischaemic-icd-codes">any ischaemic ICD codes<a class="anchor" aria-label="anchor" href="#any-ischaemic-icd-codes"></a>
</h2>
<p>ischaemic_cols &lt;- c(“myocardial_infarction”,
“coronary_artery_bypass_grafting”, “percutaneous_coronary_intervention”,
“thrombolysis_coronary”, “ischaemic_cardiomyopathy”) cohort[, ischaemic
:= rowSums(.SD) &gt; 0, .SDcols = ischaemic_cols] cohort[,
ischaemic_first_date := do.call(pmin, c(.SD, na.rm = TRUE)), .SDcols =
paste0(ischaemic_cols, “_first_date”)]</p>
</div>
<div class="section level2">
<h2 id="combined-nicm-icd-codes">combined NICM ICD codes<a class="anchor" aria-label="anchor" href="#combined-nicm-icd-codes"></a>
</h2>
<p>nicm_cols &lt;- c(“dilated_cardiomyopathy”,
“dilated_cardiomyopathy_associated_with”,
“left_ventricular_systolic_dysfunction”) cohort[, nicm_comb :=
rowSums(.SD) &gt; 0, .SDcols = nicm_cols] cohort[, nicm_comb_first_date
:= do.call(pmin, c(.SD, na.rm = TRUE)), .SDcols = paste0(nicm_cols,
“_first_date”)]</p>
</div>
<div class="section level2">
<h2 id="any-ischaemic-self-reported-codes">any ischaemic self reported codes<a class="anchor" aria-label="anchor" href="#any-ischaemic-self-reported-codes"></a>
</h2>
<p>self_isch_cols &lt;- c(“myocardial_infarction_self_reported”,
“coronary_artery_bypass_grafting_self_reported”,
“percutaneous_coronary_intervention_self_reported”) cohort[, self_isch
:= rowSums(.SD) &gt; 0, .SDcols = self_isch_cols] cohort[,
self_isch_first_date := do.call(pmin, c(.SD, na.rm = TRUE)), .SDcols =
paste0(self_isch_cols, “_first_date”)]</p>
</div>
<div class="section level2">
<h2 id="any-self-reported-hf-codes">any self reported HF codes<a class="anchor" aria-label="anchor" href="#any-self-reported-hf-codes"></a>
</h2>
<p>self_hf_col = c(“heart_failure_self_reported”) cohort[, self_hf :=
rowSums(.SD) &gt; 0, .SDcols = self_hf_col] cohort[, self_hf_first_date
:= do.call(pmin, c(.SD, na.rm = TRUE)), .SDcols = paste0(self_hf_col,
“_first_date”)]</p>
</div>
<div class="section level2">
<h2 id="any-self-reported-hcm-codes">any self reported HCM codes<a class="anchor" aria-label="anchor" href="#any-self-reported-hcm-codes"></a>
</h2>
<p>self_hcm_col = c(“hypertrophic_cardiomyopathy_self_reported”)
cohort[, self_hcm := rowSums(.SD) &gt; 0, .SDcols = self_hcm_col]
cohort[, self_hcm_first_date := do.call(pmin, c(.SD, na.rm = TRUE)),
.SDcols = paste0(self_hcm_col, “_first_date”)]</p>
</div>
<div class="section level2">
<h2 id="hf-exclusions">HF exclusions<a class="anchor" aria-label="anchor" href="#hf-exclusions"></a>
</h2>
<p>cohort[, hf_exclude := withdrawal == TRUE |
congenital_heart_disease==TRUE | # all congenital heart disease
(heart_failure==FALSE &amp; (self_hf==TRUE | ischaemic==TRUE |
self_isch==TRUE)) | # non-HF but with ischaemic ICD history or self
reported heart failure or ischaemic history (heart_failure==TRUE &amp;
(ischaemic==TRUE &amp; ischaemic_first_date &gt;
heart_failure_first_date))] # HF but with first ischaemic event after
the HF diagnosis # pheno 1 cohort[, pheno1 :=
congenital_heart_disease==FALSE &amp; heart_failure==TRUE]</p>
</div>
<div class="section level2">
<h2 id="pheno-2">pheno 2<a class="anchor" aria-label="anchor" href="#pheno-2"></a>
</h2>
<p>cohort[, pheno2 := hf_exclude==FALSE &amp; heart_failure==TRUE &amp;
ischaemic==TRUE]</p>
</div>
<div class="section level2">
<h2 id="pheno-3">pheno 3<a class="anchor" aria-label="anchor" href="#pheno-3"></a>
</h2>
<p>cohort[, pheno3 := hf_exclude==FALSE &amp; heart_failure==TRUE &amp;
ischaemic==FALSE]</p>
</div>
<div class="section level2">
<h2 id="hf-controls">HF controls<a class="anchor" aria-label="anchor" href="#hf-controls"></a>
</h2>
<p>cohort[, hf_control := hf_exclude==FALSE &amp; pheno1==FALSE &amp;
pheno2==FALSE &amp; pheno3==FALSE]</p>
</div>
<div class="section level2">
<h2 id="dcm-exclusions">DCM exclusions<a class="anchor" aria-label="anchor" href="#dcm-exclusions"></a>
</h2>
<p>cohort[, cm_exclude := withdrawal == TRUE |
congenital_heart_disease==TRUE | # all congenital heart disease
hypertrophic_cardiomyopathy==TRUE | self_hcm==TRUE | # all HCM
restrictive_cardiomyopathy==TRUE] # all RCM</p>
</div>
<div class="section level2">
<h2 id="pheno-4">pheno 4<a class="anchor" aria-label="anchor" href="#pheno-4"></a>
</h2>
<p>cohort[, pheno4 := cm_exclude==FALSE &amp;
!(dilated_cardiomyopathy==TRUE &amp; (ischaemic==TRUE &amp;
ischaemic_first_date &lt;= dilated_cardiomyopathy_first_date)) &amp; #
DCM but with first ischaemic event prior to the DCM diagnosis
dilated_cardiomyopathy==TRUE]</p>
</div>
<div class="section level2">
<h2 id="pheno-5">pheno 5<a class="anchor" aria-label="anchor" href="#pheno-5"></a>
</h2>
<p>cohort[, pheno5 := cm_exclude==FALSE &amp; !(nicm_comb==TRUE &amp;
(ischaemic==TRUE &amp; ischaemic_first_date &lt;= nicm_comb_first_date))
&amp; # NICM but with first ischaemic event prior to the NICM diagnosis
nicm_comb==TRUE]</p>
</div>
<div class="section level2">
<h2 id="cm-controls">CM controls<a class="anchor" aria-label="anchor" href="#cm-controls"></a>
</h2>
<p>cohort[, cm_control := cm_exclude==FALSE &amp; pheno4==FALSE &amp;
pheno5==FALSE &amp; ischaemic==FALSE &amp; self_isch==FALSE]</p>
</div>
<div class="section level2">
<h2 id="check-hf-phenotyping">check HF phenotyping<a class="anchor" aria-label="anchor" href="#check-hf-phenotyping"></a>
</h2>
<p>base_cols &lt;- c(“eid”, “age”, “sex”, “ethnicity”,
“ethnicity_group”,“genetic_sex”, “genetic_ethnicity”, paste0(“pc”,1:12))
sum_cols &lt;- names(cohort)[!names(cohort) %in% base_cols &amp;
!grepl(“date”, names(cohort))] summary &lt;- data.table (name =
c(“total”, sum_cols), sex = “all”, N = c(nrow(cohort), cohort[,
.(sapply(.SD, sum)), .SDcols = sum_cols]$V1)) summary &lt;-
rbind(summary, data.table(name = rep(sum_cols, 2), cohort[, .(N =
sapply(.SD, sum)), .SDcols = sum_cols, by = “sex”]), fill=TRUE)
summary</p>
</div>
<div class="section level2">
<h2 id="write-summary">write summary<a class="anchor" aria-label="anchor" href="#write-summary"></a>
</h2>
<p>fwrite(dcast(summary, name ~ sex, value.var = “N”), file =
file.path(Sys.getenv(“DATA_DIR”), “ukbb_81499_20241114”,
“hermes3_phenotype_summary.tsv”), sep = “)</p>
<p>cat(“Total =”, summary[name==“total”,N], “; Sum (exc/crtl/1) =”,
sum(summary[name%in%c(“hf_exclude”,paste0(“pheno1”),“hf_control”), N]),
“”) cat(“Total =”, summary[name==“total”,N], “; Sum (exc/crtl/2/3) =”,
sum(summary[name%in%c(“hf_exclude”,paste0(“pheno”,2:3),“hf_control”),
N]), “”) cat(“Total =”, summary[name==“total”,N], “; Sum (exc/crtl/5)
=”, sum(summary[name%in%c(“cm_exclude”,paste0(“pheno5”),“cm_control”),
N]), “”)</p>
</div>
<div class="section level2">
<h2 id="write-out">write out<a class="anchor" aria-label="anchor" href="#write-out"></a>
</h2>
<p>fwrite(cohort[, mget(c(base_cols[base_cols != “eid”], paste0(“pheno”,
1:3), “hf_exclude”, “hf_control”, paste0(“pheno”, 4:5), “cm_exclude”,
“cm_control”))], file = file.path(Sys.getenv(“DATA_DIR”),
“ukbb_81499_20241114”, “hermes3_phenotypes.tsv.gz”), sep = “)</p>
</div>
<div class="section level2">
<h2 id="random-test-samples">random test samples<a class="anchor" aria-label="anchor" href="#random-test-samples"></a>
</h2>
<p>set.seed(123) cohort[hf_exclude==T][sample.int(.N, 3), eid] #
5607008-Y 3463412-Y 3399308-Y set.seed(123)
cohort[hf_control==T][sample.int(.N, 3), eid] # 5617489-Y 1398510-Y
3387157-Y set.seed(123) cohort[pheno1==T][sample.int(.N, 3), eid] #
5087228-Y 3558314-Y 5669956-Y set.seed(123)
cohort[pheno2==T][sample.int(.N, 3), eid] # 4964821-Y 5145334-Y
4110018-Y set.seed(123) cohort[pheno3==T][sample.int(.N, 3), eid] #
1535528-Y 1660078-Y 4720288-Y set.seed(123)
cohort[pheno4==T][sample.int(.N, 3), eid] # 4547830-Y 5543541-Y
4762107-Y set.seed(123) cohort[pheno5==T][sample.int(.N, 3), eid] #
2469121-Y 2659022-Y 1340307-Y set.seed(123)
cohort[cm_control==T][sample.int(.N, 3), eid] # 5335780-Y 1276673-Y
3304835-Y set.seed(123) cohort[cm_exclude==T][sample.int(.N, 3), eid] #
2946309-Y 4951293-Y 4815931-Y</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicholas Sunderland.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
