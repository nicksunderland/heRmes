<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>HERMES QUALITY CONTROL • heRmes</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="HERMES QUALITY CONTROL">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">heRmes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/hermes_3.html">HERMES 3.0</a></li>
    <li><a class="dropdown-item" href="../articles/hermes_qc_script.html">HERMES QUALITY CONTROL</a></li>
    <li><a class="dropdown-item" href="../articles/old/nih_cardiomyopathy.html">Cardiomyopathy phenotyping NIH</a></li>
    <li><a class="dropdown-item" href="../articles/ukbb_phenotyping.html">UKBB phenotyping example</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>HERMES QUALITY CONTROL</h1>
            
      

      <div class="d-none name"><code>hermes_qc_script.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="required-r-libraries">Required R libraries<a class="anchor" aria-label="anchor" href="#required-r-libraries"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/trevorld/r-argparse" class="external-link">argparse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cli.r-lib.org" class="external-link">cli</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: viridisLite</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="script-location">Script location<a class="anchor" aria-label="anchor" href="#script-location"></a>
</h2>
<p><a href="https://github.com/nicksunderland/heRmes/blob/main/scripts/gwas_qc.R" class="external-link uri">https://github.com/nicksunderland/heRmes/blob/main/scripts/gwas_qc.R</a></p>
</div>
<div class="section level2">
<h2 id="qc-script-inputs">QC script inputs<a class="anchor" aria-label="anchor" href="#qc-script-inputs"></a>
</h2>
<p>The QC script input parameters can be seen by calling the script with
the <code>--help</code> flag.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">Rscript</span> <span class="va">$QC_SCRIPT</span> <span class="at">--help</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt;  [36m── [39m  [1mQC script - active arguments [22m  [36m──────────────────────────────────────────────── [39m</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; usage: /home/runner/work/heRmes/heRmes/scripts/gwas_qc.R [-h] [-v] [-q]</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt;                                                          [-g GWAS] [-r REF]</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt;                                                          [-o OUTPUT]</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt;                                                          [-chr GWAS_CHR]</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt;                                                          [-bp GWAS_BP]</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt;                                                          [-ea GWAS_EA]</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt;                                                          [-oa GWAS_OA]</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt;                                                          [-eaf GWAS_EAF]</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt;                                                          [-beta GWAS_BETA]</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt;                                                          [-se GWAS_SE]</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt;                                                          [-p GWAS_P]</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt;                                                          [-n GWAS_N]</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt;                                                          [-info GWAS_INFO]</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt;                                                          [-r_id REF_ID]</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt;                                                          [-r_chr REF_CHR]</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt;                                                          [-r_bp REF_BP]</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co">#&gt;                                                          [-r_ea REF_EA]</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co">#&gt;                                                          [-r_oa REF_OA]</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">#&gt;                                                          [-r_eaf REF_EAF]</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co">#&gt;                                                          [-gc] [-noind]</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="co">#&gt;                                                          [-fd FREQ_DIFF]</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co">#&gt;                                                          [-it INFO_THRESH]</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co">#&gt; options:</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="co">#&gt;   -h, --help            show this help message and exit</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="co">#&gt;   -v, --verbose         Print extra output [default]</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="co">#&gt;   -q, --quietly         Print little output</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="co">#&gt;   -g GWAS, --gwas GWAS  GWAS file path</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a><span class="co">#&gt;   -r REF, --ref REF     Reference file path</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="co">#&gt;   -o OUTPUT, --output OUTPUT</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="co">#&gt;                         Output directory path</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a><span class="co">#&gt;   -chr GWAS_CHR, --gwas_chr GWAS_CHR</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a><span class="co">#&gt;                         Chromosome column name in the GWAS file</span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a><span class="co">#&gt;   -bp GWAS_BP, --gwas_bp GWAS_BP</span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="co">#&gt;                         Base position column name in the GWAS file</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="co">#&gt;   -ea GWAS_EA, --gwas_ea GWAS_EA</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="co">#&gt;                         Effect allele column name in the GWAS file</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="co">#&gt;   -oa GWAS_OA, --gwas_oa GWAS_OA</span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a><span class="co">#&gt;                         Other allele column name in the GWAS file</span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a><span class="co">#&gt;   -eaf GWAS_EAF, --gwas_eaf GWAS_EAF</span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a><span class="co">#&gt;                         Effect allele frequency column name in the GWAS file</span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a><span class="co">#&gt;   -beta GWAS_BETA, --gwas_beta GWAS_BETA</span></span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a><span class="co">#&gt;                         Beta column name in the GWAS file</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a><span class="co">#&gt;   -se GWAS_SE, --gwas_se GWAS_SE</span></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a><span class="co">#&gt;                         Standard error column name in the GWAS file</span></span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a><span class="co">#&gt;   -p GWAS_P, --gwas_p GWAS_P</span></span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a><span class="co">#&gt;                         P-value column name in the GWAS file</span></span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a><span class="co">#&gt;   -n GWAS_N, --gwas_n GWAS_N</span></span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a><span class="co">#&gt;                         Sample size column name in the GWAS file</span></span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a><span class="co">#&gt;   -info GWAS_INFO, --gwas_info GWAS_INFO</span></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a><span class="co">#&gt;                         Imputation information score column name in the GWAS</span></span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a><span class="co">#&gt;                         file</span></span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a><span class="co">#&gt;   -r_id REF_ID, --ref_id REF_ID</span></span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a><span class="co">#&gt;                         Reference rsid column name in the REF file</span></span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a><span class="co">#&gt;   -r_chr REF_CHR, --ref_chr REF_CHR</span></span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a><span class="co">#&gt;                         Reference chromosome column name in the REF file</span></span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a><span class="co">#&gt;   -r_bp REF_BP, --ref_bp REF_BP</span></span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a><span class="co">#&gt;                         Reference base position column name in the REF file</span></span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a><span class="co">#&gt;   -r_ea REF_EA, --ref_ea REF_EA</span></span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a><span class="co">#&gt;                         Reference effect allele column name in the REF file</span></span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a><span class="co">#&gt;   -r_oa REF_OA, --ref_oa REF_OA</span></span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a><span class="co">#&gt;                         Reference other allele column name in the REF file</span></span>
<span id="cb2-66"><a href="#cb2-66" tabindex="-1"></a><span class="co">#&gt;   -r_eaf REF_EAF, --ref_eaf REF_EAF</span></span>
<span id="cb2-67"><a href="#cb2-67" tabindex="-1"></a><span class="co">#&gt;                         Reference effect allele frequency column name in the</span></span>
<span id="cb2-68"><a href="#cb2-68" tabindex="-1"></a><span class="co">#&gt;                         REF file</span></span>
<span id="cb2-69"><a href="#cb2-69" tabindex="-1"></a><span class="co">#&gt;   -gc, --genomic_control</span></span>
<span id="cb2-70"><a href="#cb2-70" tabindex="-1"></a><span class="co">#&gt;                         Apply genomic control for adjusting study results</span></span>
<span id="cb2-71"><a href="#cb2-71" tabindex="-1"></a><span class="co">#&gt;                         [default=FALSE]</span></span>
<span id="cb2-72"><a href="#cb2-72" tabindex="-1"></a><span class="co">#&gt;   -noind, --no_indel_alleles</span></span>
<span id="cb2-73"><a href="#cb2-73" tabindex="-1"></a><span class="co">#&gt;                         Remove indel alleles [default=FALSE]</span></span>
<span id="cb2-74"><a href="#cb2-74" tabindex="-1"></a><span class="co">#&gt;   -fd FREQ_DIFF, --freq_diff FREQ_DIFF</span></span>
<span id="cb2-75"><a href="#cb2-75" tabindex="-1"></a><span class="co">#&gt;                         Retain variants with GWAS:REF allele frequency</span></span>
<span id="cb2-76"><a href="#cb2-76" tabindex="-1"></a><span class="co">#&gt;                         different less than ... [default=0.2]</span></span>
<span id="cb2-77"><a href="#cb2-77" tabindex="-1"></a><span class="co">#&gt;   -it INFO_THRESH, --info_thresh INFO_THRESH</span></span>
<span id="cb2-78"><a href="#cb2-78" tabindex="-1"></a><span class="co">#&gt;                         Retain variants with info score greater than ...</span></span>
<span id="cb2-79"><a href="#cb2-79" tabindex="-1"></a><span class="co">#&gt;                         [default=NULL (off)]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reviewer-qc-input-controls">Reviewer QC input controls<a class="anchor" aria-label="anchor" href="#reviewer-qc-input-controls"></a>
</h2>
<p>The main required inputs required are in the table below, we likely
will need to add more.</p>
<table class="table">
<colgroup>
<col width="24%">
<col width="9%">
<col width="49%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th>Arg</th>
<th>Type</th>
<th>Source</th>
<th>Expose to UI</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>–gwas</td>
<td>string</td>
<td>uploaded gwas file</td>
<td>NA</td>
</tr>
<tr class="even">
<td>–ref</td>
<td>string</td>
<td>static ancestry-specific reference file</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>–out</td>
<td>string</td>
<td>output directory to write file and .pngs</td>
<td>NA</td>
</tr>
<tr class="even">
<td>–gwas_[colname]</td>
<td>string</td>
<td>standard column names from mapping</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>–ref_[colname]</td>
<td>string</td>
<td>standard column names from reference file</td>
<td>NA</td>
</tr>
<tr class="even">
<td>–no_indel_alleles</td>
<td>bool</td>
<td>reviewer QC user interface</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td>–freq_diff</td>
<td>num</td>
<td>reviewer QC user interface</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>–genomic_control</td>
<td>bool</td>
<td>reviewer QC user interface</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td>–info_thresh</td>
<td>num</td>
<td>reviewer QC user interface</td>
<td>Yes</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="example-qc-script-call">Example QC script call<a class="anchor" aria-label="anchor" href="#example-qc-script-call"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Rscript /Users/xx20081/git/heRmes/scripts/gwas_qc.R -h</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="ex">Rscript</span> /Users/xx20081/git/heRmes/scripts/gwas_qc.R <span class="dt">\</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="at">--gwas</span> <span class="st">'/Users/xx20081/Desktop/meta.all.allcause_death.autosomes_test_small.tsv'</span> <span class="dt">\</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="at">--gwas_chr</span> <span class="st">'chr'</span> <span class="dt">\</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="at">--gwas_bp</span> <span class="st">'bp'</span> <span class="dt">\</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  <span class="at">--gwas_ea</span> <span class="st">'ea'</span> <span class="dt">\</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="at">--gwas_oa</span> <span class="st">'oa'</span> <span class="dt">\</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="at">--gwas_eaf</span> <span class="st">'eaf'</span> <span class="dt">\</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  <span class="at">--gwas_beta</span> <span class="st">'beta'</span> <span class="dt">\</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>  <span class="at">--gwas_se</span> <span class="st">'se'</span> <span class="dt">\</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  <span class="at">--gwas_p</span> <span class="st">'p'</span> <span class="dt">\</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="at">--gwas_n</span> <span class="st">'n'</span> <span class="dt">\</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="at">--ref</span> <span class="st">'/Users/xx20081/Documents/local_data/genome_reference/hrc_37/HRC.r1-1.GRCh37.wgs.mac5.sites.tab.gz'</span> <span class="dt">\</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  <span class="at">--ref_id</span> <span class="st">'ID'</span> <span class="dt">\</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  <span class="at">--ref_chr</span> <span class="st">'#CHROM'</span> <span class="dt">\</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>  <span class="at">--ref_bp</span> <span class="st">'POS'</span> <span class="dt">\</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>  <span class="at">--ref_ea</span> <span class="st">'ALT'</span> <span class="dt">\</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>  <span class="at">--ref_oa</span> <span class="st">'REF'</span> <span class="dt">\</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>  <span class="at">--ref_eaf</span> <span class="st">'AF'</span> <span class="dt">\</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>  <span class="at">--freq_diff</span> 0.2 <span class="dt">\</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>  <span class="at">--out</span> <span class="st">'/Users/xx20081/Desktop/qc_tests'</span> <span class="dt">\</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>  <span class="at">--no_indel_alleles</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="ex">Rscript</span> /Users/xx20081/git/heRmes/scripts/gwas_qc.R <span class="dt">\</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>  <span class="at">--gwas</span> <span class="st">'/Users/xx20081/Downloads/sample-gwas-expanded.csv'</span> <span class="dt">\</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>  <span class="at">--gwas_chr</span> <span class="st">'CHR'</span> <span class="dt">\</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>  <span class="at">--gwas_bp</span> <span class="st">'BP'</span> <span class="dt">\</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>  <span class="at">--gwas_ea</span> <span class="st">'EA'</span> <span class="dt">\</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>  <span class="at">--gwas_oa</span> <span class="st">'OA'</span> <span class="dt">\</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>  <span class="at">--gwas_eaf</span> <span class="st">'EUR_EAF'</span> <span class="dt">\</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>  <span class="at">--gwas_beta</span> <span class="st">'BETA'</span> <span class="dt">\</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>  <span class="at">--gwas_se</span> <span class="st">'SE'</span> <span class="dt">\</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>  <span class="at">--gwas_p</span> <span class="st">'P'</span> <span class="dt">\</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>  <span class="at">--gwas_n</span> <span class="st">'N'</span> <span class="dt">\</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>  <span class="at">--ref</span> <span class="st">'/Users/xx20081/Documents/local_data/genome_reference/hrc_37/HRC.r1-1.GRCh37.wgs.mac5.sites.tab.gz'</span> <span class="dt">\</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>  <span class="at">--ref_id</span> <span class="st">'ID'</span> <span class="dt">\</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>  <span class="at">--ref_chr</span> <span class="st">'#CHROM'</span> <span class="dt">\</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a>  <span class="at">--ref_bp</span> <span class="st">'POS'</span> <span class="dt">\</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>  <span class="at">--ref_ea</span> <span class="st">'ALT'</span> <span class="dt">\</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>  <span class="at">--ref_oa</span> <span class="st">'REF'</span> <span class="dt">\</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>  <span class="at">--ref_eaf</span> <span class="st">'AF'</span> <span class="dt">\</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a>  <span class="at">--freq_diff</span> 0.2 <span class="dt">\</span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a>  <span class="at">--out</span> <span class="st">'/Users/xx20081/Desktop/qc_tests'</span> <span class="dt">\</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a>  <span class="at">--no_indel_alleles</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="qc-script">QC script<a class="anchor" aria-label="anchor" href="#qc-script"></a>
</h2>
<p>The quality control procedure code is presented below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#!/usr/bin/env Rscript</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  Nick Sunderland &lt;nicholas.sunderland@bristol.ac.uk&gt;</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  GWAS QC script</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  Command line options= run this script with the -h/--help flag to see options</span></span>
<span><span class="co">#  Some good resources here: https://github.com/swvanderlaan/MetaGWASToolKit/tree/master/SCRIPTS</span></span>
<span><span class="co">#</span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># required packages</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/trevorld/r-argparse" class="external-link">argparse</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cli.r-lib.org" class="external-link">cli</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># parse cli arguments</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_h1.html" class="external-link">cli_h1</a></span><span class="op">(</span><span class="st">"QC script - active arguments"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">parser</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/argparse/man/ArgumentParser.html" class="external-link">ArgumentParser</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># basic controls</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-v"</span>, <span class="st">"--verbose"</span>,    action<span class="op">=</span><span class="st">"store_true"</span>,  default<span class="op">=</span><span class="cn">TRUE</span>,     help<span class="op">=</span><span class="st">"Print extra output [default]"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-q"</span>, <span class="st">"--quietly"</span>,    action<span class="op">=</span><span class="st">"store_false"</span>, dest<span class="op">=</span><span class="st">"verbose"</span>,   help<span class="op">=</span><span class="st">"Print little output"</span><span class="op">)</span></span>
<span><span class="co"># file paths and file handling</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-g"</span>, <span class="st">"--gwas"</span>,       action<span class="op">=</span><span class="st">"store"</span>,       type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"GWAS file path"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-r"</span>, <span class="st">"--ref"</span>,        action<span class="op">=</span><span class="st">"store"</span>,       type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Reference file path"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-o"</span>, <span class="st">"--output"</span>,     action<span class="op">=</span><span class="st">"store"</span>,       type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Output directory path"</span><span class="op">)</span></span>
<span><span class="co"># GWAS file columns</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-chr"</span>, <span class="st">"--gwas_chr"</span>,  action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Chromosome column name in the GWAS file"</span>, default <span class="op">=</span> <span class="st">"chr"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-bp"</span>,  <span class="st">"--gwas_bp"</span>,   action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Base position column name in the GWAS file"</span>, default <span class="op">=</span> <span class="st">"bp"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-ea"</span>,  <span class="st">"--gwas_ea"</span>,   action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Effect allele column name in the GWAS file"</span>, default <span class="op">=</span> <span class="st">"ea"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-oa"</span>,  <span class="st">"--gwas_oa"</span>,   action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Other allele column name in the GWAS file"</span>, default <span class="op">=</span> <span class="st">"oa"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-eaf"</span>, <span class="st">"--gwas_eaf"</span>,  action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Effect allele frequency column name in the GWAS file"</span>, default <span class="op">=</span> <span class="st">"eaf"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-beta"</span>,<span class="st">"--gwas_beta"</span>, action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Beta column name in the GWAS file"</span>, default <span class="op">=</span> <span class="st">"beta"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-se"</span>,  <span class="st">"--gwas_se"</span>,   action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Standard error column name in the GWAS file"</span>, default <span class="op">=</span> <span class="st">"se"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-p"</span>,   <span class="st">"--gwas_p"</span>,    action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"P-value column name in the GWAS file"</span>, default <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-n"</span>,   <span class="st">"--gwas_n"</span>,    action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Sample size column name in the GWAS file"</span>, default <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-info"</span>,<span class="st">"--gwas_info"</span>, action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Imputation information score column name in the GWAS file"</span>, default <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co"># Reference file columns</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-r_id"</span>,  <span class="st">"--ref_id"</span>,  action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Reference rsid column name in the REF file"</span>, default <span class="op">=</span> <span class="st">"chr"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-r_chr"</span>, <span class="st">"--ref_chr"</span>, action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Reference chromosome column name in the REF file"</span>, default <span class="op">=</span> <span class="st">"chr"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-r_bp"</span>,  <span class="st">"--ref_bp"</span>,  action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Reference base position column name in the REF file"</span>, default <span class="op">=</span> <span class="st">"bp"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-r_ea"</span>,  <span class="st">"--ref_ea"</span>,  action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Reference effect allele column name in the REF file"</span>, default <span class="op">=</span> <span class="st">"ea"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-r_oa"</span>,  <span class="st">"--ref_oa"</span>,  action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Reference other allele column name in the REF file"</span>, default <span class="op">=</span> <span class="st">"oa"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-r_eaf"</span>, <span class="st">"--ref_eaf"</span>, action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"character"</span>, help<span class="op">=</span><span class="st">"Reference effect allele frequency column name in the REF file"</span>, default <span class="op">=</span> <span class="st">"eaf"</span><span class="op">)</span></span>
<span><span class="co"># QC parameters</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-gc"</span>,    <span class="st">"--genomic_control"</span>, action<span class="op">=</span><span class="st">"store_true"</span>, default<span class="op">=</span><span class="cn">FALSE</span>, help<span class="op">=</span><span class="st">"Apply genomic control for adjusting study results [default=FALSE]"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-noind"</span>, <span class="st">"--no_indel_alleles"</span>, action<span class="op">=</span><span class="st">"store_true"</span>, default<span class="op">=</span><span class="cn">FALSE</span>, help<span class="op">=</span><span class="st">"Remove indel alleles [default=FALSE]"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-fd"</span>,    <span class="st">"--freq_diff"</span>, action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"numeric"</span>, default<span class="op">=</span><span class="fl">0.2</span>, help<span class="op">=</span><span class="st">"Retain variants with GWAS:REF allele frequency different less than ... [default=0.2]"</span><span class="op">)</span></span>
<span><span class="va">parser</span><span class="op">$</span><span class="fu">add_argument</span><span class="op">(</span><span class="st">"-it"</span>,    <span class="st">"--info_thresh"</span>, action<span class="op">=</span><span class="st">"store"</span>, type<span class="op">=</span><span class="st">"numeric"</span>, default<span class="op">=</span><span class="cn">NULL</span>, help<span class="op">=</span><span class="st">"Retain variants with info score greater than ... [default=NULL (off)]"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parse CLI arguments</span></span>
<span><span class="va">args</span> <span class="op">&lt;-</span> <span class="va">parser</span><span class="op">$</span><span class="fu">parse_args</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print out the arguments used to the console</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">args</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://cli.r-lib.org/reference/cli_text.html" class="external-link">cli_text</a></span><span class="op">(</span><span class="st">"{.strong {names(args)[i]}} = {.val {args[[i]]}}"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># start QC run</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_h1.html" class="external-link">cli_h1</a></span><span class="op">(</span><span class="st">"Running GWAS quality control"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># summary table to be iteratively filled</span></span>
<span><span class="va">summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># basic check files</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"checking file paths and columns names"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check GWAS file path provided and that we can read from it</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas</span><span class="op">)</span> <span class="op">||</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/file.access.html" class="external-link">file.access</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli_abort</a></span><span class="op">(</span><span class="st">"GWAS file path `{.file {args$gwas}}` does not exist or is not readable"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check GWAS file column names all present</span></span>
<span><span class="va">gwas_header</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas</span>, nrows <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">gwas_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gwas_chr"</span>,<span class="st">"gwas_bp"</span>,<span class="st">"gwas_ea"</span>,<span class="st">"gwas_oa"</span>,<span class="st">"gwas_eaf"</span>,<span class="st">"gwas_beta"</span>,<span class="st">"gwas_se"</span>,<span class="st">"gwas_p"</span>,<span class="st">"gwas_n"</span><span class="op">)</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gwas_header</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">gwas_cols</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">gwas_cols</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">gwas_cols</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://cli.r-lib.org/reference/cli_alert.html" class="external-link">cli_alert_success</a></span><span class="op">(</span><span class="st">"{names(gwas_cols)[i]} = {args[names(gwas_cols)[i]]}"</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://cli.r-lib.org/reference/cli_alert.html" class="external-link">cli_alert_danger</a></span><span class="op">(</span><span class="st">"{names(gwas_cols)[i]} = {args[names(gwas_cols)[i]]}"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli_abort</a></span><span class="op">(</span><span class="st">"Columns not all found in GWAS file columns [{names(gwas_header)}]"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check reference file path provided and that we can read from in</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">ref</span><span class="op">)</span> <span class="op">||</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">ref</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/file.access.html" class="external-link">file.access</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">ref</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli_abort</a></span><span class="op">(</span><span class="st">"Reference file path `{.file {args$reference}}` does not exist or is not readable"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check GWAS file column names all present</span></span>
<span><span class="va">ref_header</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">ref</span>, nrows <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">ref_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ref_id"</span>, <span class="st">"ref_chr"</span>,<span class="st">"ref_bp"</span>,<span class="st">"ref_ea"</span>,<span class="st">"ref_oa"</span>,<span class="st">"ref_eaf"</span><span class="op">)</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ref_header</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">ref_cols</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">ref_cols</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">ref_cols</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://cli.r-lib.org/reference/cli_alert.html" class="external-link">cli_alert_success</a></span><span class="op">(</span><span class="st">"{names(ref_cols)[i]} = {args[names(ref_cols)[i]]}"</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://cli.r-lib.org/reference/cli_alert.html" class="external-link">cli_alert_danger</a></span><span class="op">(</span><span class="st">"{names(ref_cols)[i]} = {args[names(ref_cols)[i]]}"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli_abort</a></span><span class="op">(</span><span class="st">"Columns not all found in reference file columns [{names(ref_header)}]"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check output directory exists</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">output</span><span class="op">)</span> <span class="op">||</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">output</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli_abort</a></span><span class="op">(</span><span class="st">"Output directory path `{.file {args$output}}` not provided or does not exist"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># read GWAS and reference data</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"reading GWAS"</span><span class="op">)</span></span>
<span><span class="va">gwas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"reading reference"</span><span class="op">)</span></span>
<span><span class="va">ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">ref</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_process_start.html" class="external-link">cli_process_done</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># check column data missingness</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_h1.html" class="external-link">cli_h1</a></span><span class="op">(</span><span class="st">"Checking column data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"checking column data"</span><span class="op">)</span></span>
<span><span class="va">gwas_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">args</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^gwas_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">args</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">ref_cols</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">args</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">args</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ref_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">args</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># total and NA counts</span></span>
<span><span class="va">num_na_summary</span> <span class="op">&lt;-</span> <span class="va">gwas</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="kw">function</span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>num <span class="op">=</span> <span class="va">.N</span>, num_na <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">)</span>, pct_na <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">.N</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">gwas_cols</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># add to summary table</span></span>
<span><span class="va">summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">summary</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>column   <span class="op">=</span> <span class="va">gwas_cols</span>,</span>
<span>                            std_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gwas_cols</span><span class="op">)</span>,</span>
<span>                            type     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">gwas</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">mget</a></span><span class="op">(</span><span class="va">gwas_cols</span><span class="op">)</span><span class="op">]</span>, <span class="va">typeof</span><span class="op">)</span>,</span>
<span>                            num      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">num_na_summary</span>, <span class="va">`[[`</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            num_na   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">num_na_summary</span>, <span class="va">`[[`</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            pct_na   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">num_na_summary</span>, <span class="va">`[[`</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># report to console</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_process_start.html" class="external-link">cli_process_done</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># check input data validity</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_h1.html" class="external-link">cli_h1</a></span><span class="op">(</span><span class="st">"Checking data validity"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"checking data validity"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># per column functions that return true if that row is valid</span></span>
<span><span class="va">col_fn_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  gwas_chr  <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">26</span>,</span>
<span>  gwas_bp   <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">is.integer</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>  gwas_ea   <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^[ACTG]+$|^[DI]$"</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>  gwas_oa   <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^[ACTG]+$|^[DI]$"</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>  gwas_eaf  <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">1</span>,</span>
<span>  gwas_beta <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  gwas_se   <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  gwas_p    <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;=</span><span class="fl">1</span>,</span>
<span>  gwas_n    <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">is.integer</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>  gwas_info <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;=</span><span class="fl">1</span>,</span>
<span>  ref_chr   <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">26</span>,</span>
<span>  ref_bp    <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">is.integer</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>  ref_ea    <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^[ACTG]+$|^[DI]$"</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>  ref_oa    <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^[ACTG]+$|^[DI]$"</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>  ref_eaf   <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># apply the functions to the corresponding columns and create summary table</span></span>
<span><span class="va">valid_summary</span> <span class="op">&lt;-</span> <span class="va">gwas</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">fn</span>, <span class="va">col</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu">fn</span><span class="op">(</span><span class="va">col</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">valid_pct</span> <span class="op">&lt;-</span> <span class="va">valid</span> <span class="op">/</span> <span class="va">.N</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>valid <span class="op">=</span> <span class="va">valid</span>, valid_pct <span class="op">=</span> <span class="va">valid_pct</span><span class="op">)</span></span>
<span><span class="op">}</span>, <span class="va">col_fn_list</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gwas_cols</span><span class="op">)</span><span class="op">]</span>, <span class="va">.SD</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">gwas_cols</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># add to main summary table</span></span>
<span><span class="va">summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">summary</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>valid     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">valid_summary</span>, <span class="va">`[[`</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            valid_pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">valid_summary</span>, <span class="va">`[[`</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print summary to console as well as the validity functions used</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_process_start.html" class="external-link">cli_process_done</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_div.html" class="external-link">cli_div</a></span><span class="op">(</span>theme <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>span.var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>, span.code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_h1.html" class="external-link">cli_h2</a></span><span class="op">(</span><span class="st">"Column validation functions:"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">gwas_cols</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://cli.r-lib.org/reference/cli_text.html" class="external-link">cli_text</a></span><span class="op">(</span><span class="st">"{.field {gwas_cols[i]}:} {.code {deparse(col_fn_list[[names(gwas_cols)[i]]])[2]}}"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># attempt recoding / data fixes</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_h1.html" class="external-link">cli_h1</a></span><span class="op">(</span><span class="st">"Formatting data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"formatting data"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># (re)code chromosome column as integer</span></span>
<span><span class="va">gwas</span><span class="op">[</span>, <span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_chr</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fcase.html" class="external-link">fcase</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_chr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">26</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_chr</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"(?i)^X$"</span>,   <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_chr</span><span class="op">)</span><span class="op">)</span>,         <span class="fl">23L</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"(?i)^Y$"</span>,   <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_chr</span><span class="op">)</span><span class="op">)</span>,         <span class="fl">24L</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"(?i)^(PAR|XY|YX)$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_chr</span><span class="op">)</span><span class="op">)</span>, <span class="fl">25L</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"(?i)^MT$"</span>,  <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_chr</span><span class="op">)</span><span class="op">)</span>,         <span class="fl">26L</span>,</span>
<span>                                default <span class="op">=</span> <span class="cn">NA_integer_</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># parse base position and n-sample columns to integer</span></span>
<span><span class="va">integer_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_bp</span>, <span class="va">args</span><span class="op">$</span><span class="va">gwas_n</span><span class="op">)</span></span>
<span><span class="va">gwas</span><span class="op">[</span>, <span class="op">(</span><span class="va">integer_cols</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">as.integer</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">integer_cols</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># parse frequency, beta, se, p, info columns to numeric</span></span>
<span><span class="va">numeric_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_eaf</span>, <span class="va">args</span><span class="op">$</span><span class="va">gwas_beta</span>, <span class="va">args</span><span class="op">$</span><span class="va">gwas_se</span>, <span class="va">args</span><span class="op">$</span><span class="va">gwas_p</span>, <span class="va">args</span><span class="op">$</span><span class="va">gwas_info</span><span class="op">)</span></span>
<span><span class="va">gwas</span><span class="op">[</span>, <span class="op">(</span><span class="va">numeric_cols</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">as.numeric</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">numeric_cols</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># remove allele frequencies &lt;0 or &gt;1</span></span>
<span><span class="va">gwas</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_eaf</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_eaf</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span>, <span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_eaf</span><span class="op">)</span> <span class="op">:=</span> <span class="cn">NA_real_</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># remove infinite betas</span></span>
<span><span class="va">gwas</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_beta</span><span class="op">)</span><span class="op">)</span>, <span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_beta</span><span class="op">)</span> <span class="op">:=</span> <span class="cn">NA_real_</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># remove infinite, zero, or negative standard errors</span></span>
<span><span class="va">gwas</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_se</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_se</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">0</span>, <span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_se</span><span class="op">)</span> <span class="op">:=</span> <span class="cn">NA_real_</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># recode pvalue=0 to minimum machine precision and remove p&gt;1 or p&lt;0</span></span>
<span><span class="va">gwas</span><span class="op">[</span>, <span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_p</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fcase.html" class="external-link">fcase</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_p</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span>, <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmin</span>,</span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_p</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_p</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_p</span><span class="op">)</span>,</span>
<span>                              default <span class="op">=</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># remove info scores &gt;1 or &lt;0</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">info_thresh</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_info</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">gwas</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_info</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_info</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_info</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">args</span><span class="op">$</span><span class="va">info_thresh</span>, <span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_info</span><span class="op">)</span> <span class="op">:=</span> <span class="cn">NA_real_</span><span class="op">]</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">info_thresh</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_info</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://cli.r-lib.org/reference/cli_alert.html" class="external-link">cli_alert_info</a></span><span class="op">(</span><span class="st">"info_thresh not provided, skipping info score filtering and setting info score to 1 for all variants"</span><span class="op">)</span></span>
<span>  <span class="va">gwas</span><span class="op">[</span>, <span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_info</span><span class="op">)</span> <span class="op">:=</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># alleles must be characters</span></span>
<span><span class="va">gwas</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_ea</span>, <span class="va">args</span><span class="op">$</span><span class="va">gwas_oa</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">as.character</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_ea</span>, <span class="va">args</span><span class="op">$</span><span class="va">gwas_oa</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># find indels and and number to summary, remove indels if flag specified</span></span>
<span><span class="va">indel_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">gwas</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_ea</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_oa</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"(?i)^[DI]$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_ea</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"(?i)^[DI]$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_oa</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">$</span><span class="va">V1</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">no_indel_alleles</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">gwas</span><span class="op">[</span><span class="va">indel_idx</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_ea</span>, <span class="va">args</span><span class="op">$</span><span class="va">gwas_oa</span><span class="op">)</span> <span class="op">:=</span> <span class="cn">NA_character_</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://cli.r-lib.org/reference/cli_alert.html" class="external-link">cli_alert_warning</a></span><span class="op">(</span><span class="st">"removing {length(indel_idx)} indel alleles"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">summary</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^gwas_(ea|oa)$"</span>, <span class="va">std_name</span><span class="op">)</span>, <span class="va">indels</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">indel_idx</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># ensure alleles are upper case ACTG or D/I</span></span>
<span><span class="va">gwas</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_ea</span>, <span class="va">args</span><span class="op">$</span><span class="va">gwas_oa</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"(?i)^[ACTG]+$|^[DI]$"</span>, <span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="cn">NA_character_</span><span class="op">)</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas_ea</span>, <span class="va">args</span><span class="op">$</span><span class="va">gwas_oa</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># summarise the counts during this recoding process</span></span>
<span><span class="va">postfix_na_summary</span> <span class="op">&lt;-</span> <span class="va">gwas</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="kw">function</span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>postfix_valid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">)</span>, pct_na <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">.N</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">gwas_cols</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># add to overall summary table</span></span>
<span><span class="va">summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">summary</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>postfix_valid     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">postfix_na_summary</span>, <span class="va">`[[`</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            postfix_valid_pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">postfix_na_summary</span>, <span class="va">`[[`</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove invalid rows (those containing NAs)</span></span>
<span><span class="va">gwas</span> <span class="op">&lt;-</span> <span class="va">gwas</span><span class="op">[</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">gwas</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">mget</a></span><span class="op">(</span><span class="va">gwas_cols</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">]</span></span>
<span></span>
<span><span class="co"># print updated summary to console</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># exit if no variants remain</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">gwas</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli_abort</a></span><span class="op">(</span><span class="st">"no variants remain after data validation filters - check data and summary above"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://cli.r-lib.org/reference/cli_process_start.html" class="external-link">cli_process_done</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># formatting reference</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="va">col_fn_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  ref_id    <span class="op">=</span> <span class="va">as.character</span>,</span>
<span>  ref_chr   <span class="op">=</span> <span class="va">as.character</span>,</span>
<span>  ref_bp    <span class="op">=</span> <span class="va">as.integer</span>,</span>
<span>  ref_ea    <span class="op">=</span> <span class="va">as.character</span>,</span>
<span>  ref_oa    <span class="op">=</span> <span class="va">as.character</span>,</span>
<span>  ref_eaf   <span class="op">=</span> <span class="va">as.numeric</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ref</span><span class="op">[</span> , <span class="op">(</span><span class="va">ref_cols</span><span class="op">)</span>  <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">fn</span>, <span class="va">col</span><span class="op">)</span> <span class="fu">fn</span><span class="op">(</span><span class="va">col</span><span class="op">)</span>, <span class="va">col_fn_list</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ref_cols</span><span class="op">)</span> <span class="op">]</span>, <span class="va">.SD</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">ref_cols</span> <span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># harmonise alleles</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_h1.html" class="external-link">cli_h1</a></span><span class="op">(</span><span class="st">"Harmonising to reference"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"harmonising data"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># currently the harmonising function is in my package, but probably best to supply as a stand alone script</span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu">genepi.utils</span><span class="fu">::</span><span class="fu">harmonise_gwas</span><span class="op">(</span><span class="va">gwas</span>, <span class="va">ref</span>, join <span class="op">=</span> <span class="st">"chr:bp"</span>, action <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                  gmap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>chr <span class="op">=</span> <span class="va">args</span><span class="op">$</span><span class="va">gwas_chr</span>, bp <span class="op">=</span> <span class="va">args</span><span class="op">$</span><span class="va">gwas_bp</span>, ea <span class="op">=</span> <span class="va">args</span><span class="op">$</span><span class="va">gwas_ea</span>, oa <span class="op">=</span> <span class="va">args</span><span class="op">$</span><span class="va">gwas_oa</span>, eaf <span class="op">=</span> <span class="va">args</span><span class="op">$</span><span class="va">gwas_eaf</span>, beta <span class="op">=</span> <span class="va">args</span><span class="op">$</span><span class="va">gwas_beta</span><span class="op">)</span>,</span>
<span>                                  rmap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>chr <span class="op">=</span> <span class="va">args</span><span class="op">$</span><span class="va">ref_chr</span>, bp <span class="op">=</span> <span class="va">args</span><span class="op">$</span><span class="va">ref_bp</span>, ea <span class="op">=</span> <span class="va">args</span><span class="op">$</span><span class="va">ref_ea</span>, oa <span class="op">=</span> <span class="va">args</span><span class="op">$</span><span class="va">ref_oa</span>, eaf <span class="op">=</span> <span class="va">args</span><span class="op">$</span><span class="va">ref_eaf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># harmonisation summary, add to main summary</span></span>
<span><span class="va">summary</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span>harmonised <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">h</span><span class="op">)</span>, harmonised_pct <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">h</span><span class="op">)</span><span class="op">/</span><span class="va">num</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># print updated summary to console</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># exit if no variants remain</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">h</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli_warn</a></span><span class="op">(</span><span class="st">"no variants remain after harmonisation - check data and summary above"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_process_start.html" class="external-link">cli_process_done</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># allele frequency analysis</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_h1.html" class="external-link">cli_h1</a></span><span class="op">(</span><span class="st">"Anaylsing GWAS:REF allele frequency"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"analysing allele frequency difference"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># absolute frequency difference cohort vs reference</span></span>
<span><span class="va">h</span><span class="op">[</span>, <span class="va">freq_diff</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">eaf</span> <span class="op">-</span> <span class="va">eaf_ref</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># add frequency difference counts to summary table</span></span>
<span><span class="va">diff_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"freq_diff_lt"</span>, <span class="va">args</span><span class="op">$</span><span class="va">freq_diff</span><span class="op">)</span></span>
<span><span class="va">summary</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">diff_col</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">diff_col</span>, <span class="st">"_pct"</span><span class="op">)</span><span class="op">)</span> <span class="op">:=</span> <span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">h</span><span class="op">$</span><span class="va">freq_diff</span> <span class="op">&lt;</span> <span class="va">args</span><span class="op">$</span><span class="va">freq_diff</span><span class="op">)</span>, <span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">h</span><span class="op">$</span><span class="va">freq_diff</span> <span class="op">&lt;</span> <span class="va">args</span><span class="op">$</span><span class="va">freq_diff</span><span class="op">)</span><span class="op">/</span><span class="va">num</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># print summary to console</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_process_start.html" class="external-link">cli_process_done</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the frequency differences</span></span>
<span><span class="va">eaf_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">h</span><span class="op">[</span><span class="va">freq_diff</span> <span class="op">&gt;</span> <span class="va">args</span><span class="op">$</span><span class="va">freq_diff</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">eaf_ref</span>, y <span class="op">=</span> <span class="va">eaf</span>, color <span class="op">=</span> <span class="va">freq_diff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">h</span><span class="op">[</span><span class="va">freq_diff</span> <span class="op">&gt;</span> <span class="va">args</span><span class="op">$</span><span class="va">freq_diff</span> <span class="op">&amp;</span> <span class="va">strand_flip</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">]</span>, shape <span class="op">=</span> <span class="fl">17</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span>  <span class="va">args</span><span class="op">$</span><span class="va">freq_diff</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="va">args</span><span class="op">$</span><span class="va">freq_diff</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_colour_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"mako"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Reference allele frequency"</span>, y <span class="op">=</span> <span class="st">"Cohort allele frequency"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"*red triangles strand flip"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save plot</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"plotting allele frequency difference"</span><span class="op">)</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">output</span>, <span class="st">"eaf_plot.png"</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">600</span>, height <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">eaf_plot</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_process_start.html" class="external-link">cli_process_done</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter out the frequency differences over the provided threshold</span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="va">h</span><span class="op">[</span><span class="va">freq_diff</span> <span class="op">&lt;</span> <span class="va">args</span><span class="op">$</span><span class="va">freq_diff</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># extract the data from the harmonisation table (don't need the reference columns now, except for the rsid)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">h</span>,</span>
<span>         old <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">ref_cols</span><span class="op">[[</span><span class="st">"ref_id"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"_ref"</span><span class="op">)</span>, <span class="st">"chr"</span>,<span class="st">"bp"</span>,<span class="st">"ea"</span>,<span class="st">"oa"</span>,<span class="st">"eaf"</span>,<span class="st">"beta"</span>, <span class="va">gwas_cols</span><span class="op">[[</span><span class="st">"gwas_se"</span><span class="op">]</span><span class="op">]</span>, <span class="va">gwas_cols</span><span class="op">[[</span><span class="st">"gwas_p"</span><span class="op">]</span><span class="op">]</span>, <span class="va">gwas_cols</span><span class="op">[[</span><span class="st">"gwas_n"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>         new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ref_cols</span><span class="op">[[</span><span class="st">"ref_id"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 <span class="va">gwas_cols</span><span class="op">[[</span><span class="st">"gwas_chr"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 <span class="va">gwas_cols</span><span class="op">[[</span><span class="st">"gwas_bp"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 <span class="va">gwas_cols</span><span class="op">[[</span><span class="st">"gwas_ea"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 <span class="va">gwas_cols</span><span class="op">[[</span><span class="st">"gwas_oa"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 <span class="va">gwas_cols</span><span class="op">[[</span><span class="st">"gwas_eaf"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 <span class="va">gwas_cols</span><span class="op">[[</span><span class="st">"gwas_beta"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 <span class="va">gwas_cols</span><span class="op">[[</span><span class="st">"gwas_se"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 <span class="va">gwas_cols</span><span class="op">[[</span><span class="st">"gwas_p"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 <span class="va">gwas_cols</span><span class="op">[[</span><span class="st">"gwas_n"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gwas</span> <span class="op">&lt;-</span> <span class="va">h</span><span class="op">[</span>, <span class="va">.SD</span>, .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ref_cols</span><span class="op">[[</span><span class="st">"ref_id"</span><span class="op">]</span><span class="op">]</span>, <span class="va">gwas_cols</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># PZ plot</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_h1.html" class="external-link">cli_h1</a></span><span class="op">(</span><span class="st">"Assessing for analytical issues"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"plotting PZ plot"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># TBC</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># population stratification analysis 1</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_h1.html" class="external-link">cli_h1</a></span><span class="op">(</span><span class="st">"Assessing for population stratification issues"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"calculating lambda-GC"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># TBC</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># population stratification analysis 2</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"running LDSC"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># TBC</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># save clean GWAS and summary table</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="va">sans_ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"([^.]+)\\.[[:alnum:]]+$"</span>, <span class="st">"\\1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"[.](gz|bz2|xz)$"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">gwas</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">out_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">output</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sans_ext</span>, <span class="st">'_clean.tsv.gz'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"saving clean GWAS file to {.file {out_path}}"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">gwas</span>, <span class="va">out_path</span>, sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">log_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">args</span><span class="op">$</span><span class="va">output</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sans_ext</span>, <span class="st">'_log.tsv'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_step.html" class="external-link">cli_progress_step</a></span><span class="op">(</span><span class="st">"saving log file to {.file {log_path}}"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">summary</span>, <span class="va">log_path</span>, sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># finished</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_process_start.html" class="external-link">cli_process_done</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="co"># testing</span></span>
<span><span class="co">#=============================================================================</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">args</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">gwas</span> <span class="op">=</span> <span class="st">'/Users/xx20081/Downloads/bmi_knowledge_portal_subset.tsv'</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">ref</span> <span class="op">=</span><span class="st">'/Users/xx20081/Documents/local_data/genome_reference/hrc_37/HRC.r1-1.GRCh37.wgs.mac5.sites.tab.gz'</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">gwas_beta</span><span class="op">=</span> <span class="st">"beta"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">gwas_bp</span><span class="op">=</span> <span class="st">"position"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">gwas_chr</span><span class="op">=</span> <span class="st">"chromosome"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">gwas_ea</span><span class="op">=</span> <span class="st">"alt"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">gwas_eaf</span><span class="op">=</span> <span class="st">"freq"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">gwas_info</span><span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">gwas_n</span><span class="op">=</span> <span class="st">"n"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">gwas_oa</span><span class="op">=</span> <span class="st">"reference"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">gwas_p</span><span class="op">=</span> <span class="st">"pValue"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">gwas_se</span><span class="op">=</span> <span class="st">"stdErr"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">output</span><span class="op">=</span> <span class="st">"/Users/xx20081/Desktop/qc_tests"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">overwrite</span><span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">ref_id</span><span class="op">=</span> <span class="st">"ID"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">ref_bp</span><span class="op">=</span> <span class="st">"POS"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">ref_chr</span><span class="op">=</span> <span class="st">"#CHROM"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">ref_ea</span><span class="op">=</span> <span class="st">"ALT"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">ref_eaf</span><span class="op">=</span> <span class="st">"AF"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">ref_oa</span><span class="op">=</span> <span class="st">"REF"</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">verbose</span><span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">freq_diff</span><span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">no_indel_alleles</span><span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="va">args</span><span class="op">$</span><span class="va">info_thresh</span><span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicholas Sunderland.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
